<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#202020"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="keywords" content="Nodejs,Swig,Koa,Koa2,"><meta name="description" content="Koa2 使用swig模板引擎注意事项"><link rel="icon" type="image/x-icon" href="/logo.png"><title>Koa2 使用swig模板引擎注意事项 [ 大新闻 ]</title><link rel="stylesheet" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" href="/css/microb.css"></head><body><nav class="home-menu pure-menu pure-menu-horizontal pure-menu-fixed"><ul class="pure-menu-list float-r clearfix"><li class="pure-menu-item toc-menu"><a id="menu-main-post" class="pure-menu-link" href="javascript:;"><img class="menu-icon" src="/logo.png" alt="MENU"></a></li></ul><a class="pure-menu-heading" href="/"><h1 class="title">大新闻</h1></a></nav><div class="container" id="content-outer"><div class="inner" id="content-inner"><article class="post" id="post"><header class="post-header text-center"><h1 class="title">Koa2 使用swig模板引擎注意事项</h1><time class="time" datetime="2016-05-20T07:27:19.000Z">2016-05-20</time><hr></header><div class="post-content"><p><code>koa</code>使用<code>swig</code>有多种插件，目前我测试了两款：<code>koa-swig</code> 和<code>co-views</code>. 其中<code>co-views</code>是在官方的文档中看到的，<code>koa-swig</code>是在github中找到的。</p><a id="more"></a><p>安装方式，使用<code>npm install name</code>即可。</p><p>关于路由：</p><p>如果想把路由分多个文件，例如api.router.js、web.router.js，可以使用Router的参数prefix指定。例如：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> router = <span class="built_in">require</span>(<span class="string">'koa-router'</span>)(&#123;</span><br><span class="line">	prefix: <span class="string">'/api'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.body = <span class="string">'this a api response!'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure><p>在api.js中，声明路由时，不要使用koa-generator生成的express风格的路由引用，因为路由前缀已经在路由定义中指定了，否则会404.这么写就可以了：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// routes definition</span></span><br><span class="line">koa.use(api.routes(), api.allowedMethods());</span><br><span class="line">koa.use(index.routes(), index.allowedMethods());</span><br><span class="line"></span><br><span class="line"><span class="comment">// mount root routes  </span></span><br><span class="line">app.use(koa.routes());</span><br></pre></td></tr></table></figure><h2 id="1-co-views"><a href="#1-co-views" class="headerlink" title="1. co-views"></a>1. co-views</h2><h3 id="在根目录下新建lib-render-js文件"><a href="#在根目录下新建lib-render-js文件" class="headerlink" title="在根目录下新建lib/render.js文件"></a>在根目录下新建lib/render.js文件</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Module dependencies.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> views = <span class="built_in">require</span>(<span class="string">'co-views'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// setup views mapping .html</span></span><br><span class="line"><span class="comment">// to the swig template engine</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = views(__dirname + <span class="string">'/../views'</span>, &#123;</span><br><span class="line">  map: &#123; <span class="attr">html</span>: <span class="string">'swig'</span> &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="在app中设置render"><a href="#在app中设置render" class="headerlink" title="在app中设置render"></a>在app中设置render</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const render = require(&apos;./lib/render&apos;);</span><br><span class="line">app.context.render = render;</span><br></pre></td></tr></table></figure><h3 id="在路由中使用"><a href="#在路由中使用" class="headerlink" title="在路由中使用"></a>在路由中使用</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var router = require(&apos;koa-router&apos;)();</span><br><span class="line"></span><br><span class="line">router.get(&apos;/&apos;, async function (ctx, next) &#123;</span><br><span class="line">  cxt.body = await ctx.render(&apos;index&apos;, &#123;</span><br><span class="line">    title: &apos;Hello&apos;</span><br><span class="line">  &#125;;);</span><br><span class="line">&#125;)</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure><blockquote><p>注意事项：</p><ol><li><code>co-views</code> 2.1.0版本中，必须手动指定<code>cxt.body=</code> 否则页面会not found.</li><li><code>ctx.render(&#39;page&#39;, settings)</code>，页面模型数据必须通过<code>settings</code>传入，不能使用<code>ctx.state</code></li></ol></blockquote><h2 id="2-koa-swig"><a href="#2-koa-swig" class="headerlink" title="2. koa-swig"></a>2. koa-swig</h2><h3 id="在app中设置render-1"><a href="#在app中设置render-1" class="headerlink" title="在app中设置render"></a>在app中设置render</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const path = require(&apos;path&apos;);</span><br><span class="line">const render = require(&apos;koa-swig&apos;);</span><br><span class="line">const co = require(&apos;co&apos;);</span><br><span class="line">app.context.render = co.wrap(render(&#123;</span><br><span class="line">    root: path.join(__dirname, &apos;views&apos;),</span><br><span class="line">    autoescape: true,</span><br><span class="line">    cache: &apos;memory&apos;, // disable, set to false</span><br><span class="line">    ext: &apos;html&apos;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><h3 id="在路由中使用-1"><a href="#在路由中使用-1" class="headerlink" title="在路由中使用"></a>在路由中使用</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var router = require(&apos;koa-router&apos;)();</span><br><span class="line"></span><br><span class="line">router.get(&apos;/&apos;, async function (ctx, next) &#123;</span><br><span class="line">  ctx.state = &#123;</span><br><span class="line">    title: &apos;Hello&apos;</span><br><span class="line">  &#125;;</span><br><span class="line">  await ctx.render(&apos;index&apos;);</span><br><span class="line">&#125;)</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure><blockquote><p>注意：</p><ol><li>以为node目前不支持async，app中必须使用<code>co.wrap</code>包装一下<code>render</code></li><li>可以使用<code>ctx.state</code>传递数据，可以不手动指定<code>ctx.body</code></li></ol></blockquote></div><div class="post-tags"><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Koa/">Koa</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Koa2/">Koa2</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nodejs/">Nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swig/">Swig</a></li></ul></div></article><div class="post-nav"><div class="post-nav-item post-nav-next"></div><div class="post-nav-item post-nav-prev"><a href="/2016/11/21/2016/Spring-Thymeleaf-User-Details/" rel="prev" title="Spring Thymeleaf User Details">Spring Thymeleaf User Details <span>〉</span></a></div></div><div id="toc" class="toc-article"><strong class="toc-title">目录</strong><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-co-views"><span class="toc-text">1. co-views</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在根目录下新建lib-render-js文件"><span class="toc-text">在根目录下新建lib/render.js文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在app中设置render"><span class="toc-text">在app中设置render</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在路由中使用"><span class="toc-text">在路由中使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-koa-swig"><span class="toc-text">2. koa-swig</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在app中设置render-1"><span class="toc-text">在app中设置render</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在路由中使用-1"><span class="toc-text">在路由中使用</span></a></li></ol></li></ol></div></div></div><footer class="footer text-center"><div id="bottom-inner"><a href="http://hexo.io" target="_blank" class="footer-link">Hexo</a> <a href="https://github.com/microacup/hexo-theme-micorb" target="_blank" class="footer-link">Theme microb</a></div></footer><script>var titleTime,originTitle=document.title;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="[闷声发大财中...] "+originTitle,clearTimeout(titleTime)):(document.title="[+1s] "+originTitle,titleTime=setTimeout(function(){document.title=originTitle},2e3))})</script><script>!function(e,t){e.requestAnimationFrame=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},function(){var e=t.getElementById("menu-main-post");if(e){var n=t.getElementById("toc");e.title=n?"目录":"回到顶部",e.onclick=function(){n?"block"==n.style.display?n.style.display="none":n.style.display="block":(cancelAnimationFrame(o),o=requestAnimationFrame(function e(){var n=t.body.scrollTop||t.documentElement.scrollTop;0<n?(t.body.scrollTop=t.documentElement.scrollTop=n-50,o=requestAnimationFrame(e)):cancelAnimationFrame(o)}))}}}();var o=null}(window,document)</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b6d76ecb62c0651d8e5b7f7085f443f1";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script"),ga("create","UA-78267963-1","auto"),ga("send","pageview")</script></body></html>